@page "/test"
@using BrightApricot.Client.Interfaces
@using BrightApricot.Shared.Models
@using System.Linq.Expressions
@inject IRecipeHandler RecipeHandler


    <Titlebar Title="@_title"
              BackButtonAction="(() => UnselectRecipe())"
              ShowBackButton="_showBackButton"
              @ref="_titlebar"/>


@if (_selectedRecipe == null)
{
    <RecipeListView 
        Recipes="_recipes"
        OnRecipeSelected="SelectRecipe"/>
}
    
@if (_selectedRecipe != null)
{
    <RecipeView ViewRecipe="@_selectedRecipe"/>
    
}


<BottomMenu />

@code
{
    private IEnumerable<Recipe> _recipes = new List<Recipe>();
    private Recipe _selectedRecipe;

    private string _title = "RecipeList";

    private Titlebar _titlebar;
    private bool _showBackButton;

    protected void SelectRecipe(Recipe recipe)
    {
        if (recipe == null)
            return;
        _selectedRecipe = recipe;
        UpdateTitlebar();
    }

    protected void UnselectRecipe()
    {
        _selectedRecipe = null;
        UpdateTitlebar();
    }

    private void UpdateTitlebar()
    {
        _title = _selectedRecipe == null ? "RecipeList" : "RecipeView";
        _showBackButton = _selectedRecipe != null;
        _titlebar.UpdateState();
    }

    protected override async Task OnInitializedAsync()
    {
        await RecipeHandler.BeginCommit();
        _recipes = RecipeHandler.Recipes;
    }
}
