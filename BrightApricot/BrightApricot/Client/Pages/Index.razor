@page "/"
@using BrightApricot.Client.Interfaces
@using BrightApricot.Shared.Models
@using System.Linq.Expressions
@using BrightApricot.Client.Enums
@inject IRecipeHandler RecipeHandler


    <Titlebar Title="@_title"
              BackButtonAction="(() => UnselectRecipe())"
              ShowBackButton="_showBackButton"
              @ref="_titlebar"/>


@if (_selectedRecipe == null)
{
    <RecipeListView 
        Recipes="_recipes"
        OnRecipeSelected="SelectRecipe"/>
}
    
@if (_selectedRecipe != null)
{
    <RecipeView ViewRecipe="@_selectedRecipe"/>
    
}


<ActionButton 
    CreateAction="TestAction" 
    EditAction="TestAction" 
    SaveAction="TestAction" 
    Action="_currentAction"
    @ref="_actionButton"/>

@code
{
    private IEnumerable<Recipe> _recipes = new List<Recipe>();
    private Recipe _selectedRecipe;

    private string _title = "RecipeList";

    private Titlebar _titlebar;
    private bool _showBackButton;

    private ActionTypes _currentAction = ActionTypes.Create;
    private ActionButton _actionButton;

    ///<summary>
    /// Test action... delete soon
    /// </summary>
    private void TestAction()
    {
        var variable = string.Empty;
    }

    protected void SelectRecipe(Recipe recipe)
    {
        if (recipe == null)
            return;
        _selectedRecipe = recipe;
        UpdateActionButton(ActionTypes.Edit);
        UpdateTitlebar();
    }

    private void UpdateActionButton(ActionTypes actionType)
    {
        _currentAction = actionType;
        _actionButton.UpdateAction();
    }

    protected void UnselectRecipe()
    {
        _selectedRecipe = null;
        UpdateActionButton(ActionTypes.Create);
        UpdateTitlebar();
    }

    private void UpdateTitlebar()
    {
        _title = _selectedRecipe == null ? "RecipeList" : "RecipeView";
        _showBackButton = _selectedRecipe != null;
        _titlebar.UpdateState();
    }

    protected override async Task OnInitializedAsync()
    {
        await RecipeHandler.BeginCommit();
        _recipes = RecipeHandler.Recipes;
    }
}
